# DartSystem - 智能飞镖检测系统

## 项目概述

DartSystem是一个基于计算机视觉的智能飞镖检测系统，用于实时检测和跟踪飞镖靶心的绿色LED指示灯。系统通过工业相机捕获图像，使用OpenCV进行图像处理和目标检测，并通过串口与控制系统通信，实现自动化的飞镖靶心定位。

## 系统架构

### 核心模块

1. **图像采集模块** (`main.py`)
   - 基于海康工业相机的图像采集
   - 实时图像显示和处理
   - Qt界面交互

2. **目标检测模块** (`opencv_green_detection.py`)
   - 基于HSV颜色空间的绿光检测
   - 卡尔曼滤波器实现目标跟踪
   - 自适应权重矩阵优化检测精度

3. **串口通信模块** (`serial_communication.py`)
   - 与下位机STM32通信
   - 发送状态帧和偏差值帧
   - 实时数据传输和同步

4. **视频录制模块** (`system_recorder.py`)
   - 基于ffmpeg的屏幕录制
   - 多格式支持（WebM、MP4、AVI）
   - 自动文件管理和错误处理

### 文件结构

```
DartSystem/
├── main.py                 # 主程序入口
├── opencv_green_detection.py   # 绿光检测核心算法
├── serial_communication.py     # 串口通信模块
├── system_recorder.py         # 系统录制模块
├── requirements.txt          # 项目依赖
├── README.md                # 项目文档
├── 视频录制问题与解决方案.md    # 视频录制模块文档
├── MvImport_Linux/          # 海康相机Linux SDK
└── video/                   # 录制视频存储目录
```

## 技术特性

### 1. 图像处理与检测
- HSV颜色空间分割
- 形态学处理优化
- 卡尔曼滤波跟踪
- 区域权重优化

### 2. 实时性能
- 10-30fps实时处理
- 低延迟串口通信
- 多线程优化

### 3. 可靠性设计
- 异常检测和恢复
- 数据有效性验证
- 自动重连机制

### 4. 扩展性
- 模块化设计
- 配置化参数
- 插件式架构

## 使用说明

### 环境要求
- Python 3.8+
- OpenCV 4.5+
- PyQt6
- ffmpeg

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行系统
```bash
python main.py
```

### 配置说明
1. **相机参数**
   - 曝光时间：16000
   - 增益值：15.9

2. **检测参数**
   - HSV阈值可通过界面实时调节
   - 最小检测面积：50
   - 最大检测面积：15000

3. **录制参数**
   - 默认格式：WebM
   - 默认帧率：10fps
   - 默认比特率：2000k

## 开发指南

### 添加新功能
1. 遵循模块化设计原则
2. 添加适当的错误处理
3. 更新相关文档

### 代码规范
- 遵循PEP 8
- 添加详细注释
- 使用类型提示

### 测试规范
- 单元测试覆盖核心功能
- 集成测试验证模块交互
- 性能测试确保实时性

## 常见问题

请参考 `视频录制问题与解决方案.md` 了解视频录制相关的常见问题和解决方案。

## 更新日志

### v1.0.0 (2025-03-08)
- 完善系统架构设计
- 优化视频录制功能
- 解决Wayland下的录制问题
- 改进串口通信稳定性

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。
